{% comment %}
    Renders text block for custom content or newsletter sections

    Accepts:
    - block: {Object} Block object
    - style: {String} Block inline style
    - padding_class: {String} Set class "has-padding" if background colors of the block and the body are different
    - animation_anchor: {String} ID of the element that will trigger animations

    Usage:
    {% render 'brick-text', block: block, style: style, padding_class: padding_class, animation_anchor: animation_anchor %}
{% endcomment %}

{%- liquid
  assign subheading = block.settings.subheading
  assign title = block.settings.title
  assign text = block.settings.text
  assign button_text = block.settings.button_text
  assign button_style = block.settings.button_style
  assign show_social_links = block.settings.show_social_links
  assign bg_color = block.settings.bg_color
  assign text_color = block.settings.color
  assign use_via_metafield = block.settings.use_content_via_metafield
  assign value_metafield =  product.metafields.custom[block.settings.metafield_key]
  assign animation_order = 0

  if button_style == 'btn--text' and block.settings.show_arrow
    assign button_style = button_style | append: ' btn--text-no-underline'
  endif
-%}

{%- capture style -%}
  {%- unless bg_color == 'rgba(0,0,0,0)' or bg_color == blank -%}
    --bg: {{ bg_color }};
  {%- endunless -%}

  {%- unless text_color == 'rgba(0,0,0,0)' or text_color == blank -%}
    --text: {{ text_color }};
    --text-light: {{ text_color | color_mix: settings.bg_color, 70 }};
    --text-dark: {{ text_color | color_saturate: 10 | color_darken: 15 }};
  {%- endunless -%}
{%- endcapture -%}

<div class="brick__block brick__block--text frame__item"{% if style != blank %} style="{{ style }}"{% endif %} data-prevent-transparent-header {{ block.shopify_attributes }}>
  <div class="brick__block__text{{ padding_class }}" data-overflow-frame>
    <div class="brick__block__text__inner" data-overflow-content>
      <div class="hero__content hero__content--compact {{ block.settings.align_text }}">
        {%- if subheading != blank -%}
          {%- assign font_size_class = block.settings.subheading_size | prepend: 'body-size-' -%}
          {%- assign animation_order = animation_order | plus: 1 -%}
          <p class="hero__subheading {{ font_size_class }}"
            data-aos="hero"
            data-aos-anchor="{{ animation_anchor }}"
            data-aos-order="{{ animation_order }}">{{ subheading }}</p>
        {%- endif -%}

        {%- if title != blank -%}
          {%- assign font_size_class = block.settings.heading_size | prepend: 'heading-size-' -%}
          {%- assign animation_order = animation_order | plus: 1 -%}
          <h2 class="hero__title {{ font_size_class }}"
            data-aos="hero"
            data-aos-anchor="{{ animation_anchor }}"
            data-aos-order="{{ animation_order }}">{{ title }}</h2>
        {%- endif -%}

        {%if use_via_metafield and value_metafield != blank  %}
            <ul class="text_with_logos_list_section">
            {% for item in value_metafield.value %}

            {%- liquid
              assign logo = item.image
              assign logo_width = 120
              assign sizes = logo_width | append: 'px'
              assign width = logo_width | times: 2
              assign width_retina = logo_width | times: 2
              assign widths = '100, 120, 140, 160, 180, 200, 240, 280, 320, 360, ' | append: logo_width | append: ', ' | append: width_retina
            -%}
                <li class="block-item-list">
                  <div aria-hidden="true" class="block_list_image_content">
                    {%- render 'image' image: logo, sizes: sizes, width: width, widths: widths -%}
                  </div>
                    <div class="block_list_text_content">
                      <h5>{{item.heading}}</h5>
                      <p>{{item.content}}</p>
                    </div>
                </li>
              {%endfor%}
            </ul>
        {%- elsif text != blank -%}
          {%- assign font_size_class = block.settings.text_size | prepend: 'body-size-' -%}
          {%- assign text_columns_class = block.settings.text_columns | prepend: 'columns--' -%}
          {%- assign animation_order = animation_order | plus: 1 -%}
          <div class="hero__rte {{ font_size_class }} {{ text_columns_class }}"
            data-aos="hero"
            data-aos-anchor="{{ animation_anchor }}"
            data-aos-order="{{ animation_order }}">{{ text }}</div>
        {%- endif -%}

        {%- if button_text != blank -%}
          {%- assign animation_order = animation_order | plus: 1 -%}
          <div class="hero__button"
            data-aos="hero"
            data-aos-anchor="{{ animation_anchor }}"
            data-aos-order="{{ animation_order }}">
            <a href="{{ block.settings.button_url | default: '#!' }}" class="btn {{ button_style }} {{ block.settings.button_size }} {{ block.settings.button_type }}">
              <span>{{ button_text }}</span>

              {%- if block.settings.show_arrow -%}
                {%- render 'icon-arrow-right' -%}
              {%- endif -%}
            </a>
          </div>
        {%- endif -%}

        {%- if show_social_links -%}
          {%- assign animation_order = animation_order | plus: 1 -%}
          {%- render 'social-icons', animation_anchor: animation_anchor, animation_order: animation_order -%}
        {%- endif -%}
      </div>
    </div>
  </div>
</div>